import numpy as np


def split_z_stacks(arr, round_to=0.1, min_length=4):
    """Find contiguous monotonic slices in an array, then remove duplicates.
    Return the indices of the members of each stack."""
    arr = np.round(arr / round_to) * round_to
    if len(arr) == 0:
        return []
    if len(arr) <= 2:
        return [np.arange(len(arr) + 1)]

    stacks = []
    stack = [0]
    stack_dir = 0

    for i in range(1, len(arr)):
        this_dir = np.sign(arr[i] - arr[i - 1])
        if stack_dir == 0:  # handle initial duplicates
            stack_dir = this_dir

        if this_dir * stack_dir < 0:
            if len(stack) >= min_length:
                stacks.append(stack)
            stack = [i-1, i]
            stack_dir *= -1
        elif this_dir != 0:
            stack.append(i)
    if len(stack) >= min_length:
        stacks.append(stack)

    return stacks


def test_split_z_stacks():
    stacks = split_z_stacks(np.array([1, 1, 2, 3, 3, 1, 1, 0, 0, 0, 0, 1, 1]), min_length=3)
    assert stacks == [[0, 2, 3], [4, 5, 7]], stacks

    test_data = np.array((345.779990311712, 345.779990311712, 343.17001700401306, 343.17001700401306, 343.17001700401306, 340.8599877730012, 338.4400042705238, 338.4400042705238, 336.2900170031935, 336.2900170031935, 336.2900170031935, 334.07998853363097, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 335.01998404972255, 335.01998404972255, 335.01998404972255, 337.29997812770307, 339.4599771127105, 339.4599771127105, 341.6499821469188, 341.6499821469188, 343.8800049480051, 343.8800049480051, 343.8800049480051, 346.25999978743494, 346.25999978743494, 348.429981386289, 348.429981386289, 350.7999936118722, 350.7999936118722, 350.7999936118722, 353.3200069796294, 353.3200069796294, 355.6000010576099, 355.6000010576099, 355.6000010576099, 357.82999475486577, 357.82999475486577, 357.82999475486577, 360.23001302964985, 360.23001302964985, 362.57997271604836, 362.57997271604836, 365.04000308923423, 365.04000308923423, 367.2999737318605, 367.2999737318605, 367.2999737318605, 369.67001506127417, 369.67001506127417, 371.83999666012824, 371.83999666012824, 371.83999666012824, 374.16000850498676, 374.16000850498676, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 370.699999621138, 370.699999621138, 368.4900002554059, 368.4900002554059, 368.4900002554059, 366.29001260735095, 366.29001260735095, 364.1700022853911, 364.1700022853911, 364.1700022853911, 364.1700022853911, 360.78999983146787, 360.78999983146787, 358.21000346913934, 358.21000346913934, 355.9399920050055, 355.9399920050055, 355.9399920050055, 353.5599971655756, 351.33998608216643, 351.33998608216643, 351.33998608216643, 349.23001658171415, 349.23001658171415, 349.23001658171415, 346.8999930191785, 346.8999930191785, 344.429980032146, 344.429980032146, 341.9599961489439, 341.9599961489439, 339.83998582698405, 339.83998582698405, 339.83998582698405, 337.6099921297282, 337.6099921297282, 337.6099921297282, 337.6099921297282, 337.6099921297282, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 337.12000004015863, 337.12000004015863, 337.12000004015863, 337.12000004015863, 339.5999956410378, 339.5999956410378, 342.1099972911179, 342.1099972911179, 344.68999365344644, 344.68999365344644, 346.8699869699776, 346.8699869699776, 348.9700029604137, 348.9700029604137, 348.9700029604137, 351.23000270687044, 351.23000270687044, 351.23000270687044, 351.23000270687044, 353.49998506717384, 353.49998506717384, 357.4599977582693, 357.4599977582693, 359.6600145101547, 359.6600145101547, 361.7999900598079, 361.7999900598079, 363.9399947132915, 363.9399947132915, 363.9399947132915, 366.1600057967007, 366.1600057967007, 368.4900002554059, 368.4900002554059, 370.850000763312, 370.850000763312, 370.850000763312, 372.98002280294895, 372.98002280294895, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 369.3100006785244, 366.41000770032406, 366.41000770032406, 366.41000770032406, 366.41000770032406, 366.41000770032406, 361.57999420538545, 361.57999420538545, 361.57999420538545, 359.4899899326265, 359.4899899326265, 359.4899899326265, 357.2200075723231, 355.0700203049928, 355.0700203049928, 352.7799854055047, 352.7799854055047, 352.7799854055047, 350.44000833295286, 350.44000833295286, 350.44000833295286, 348.17002597264946, 345.7699785940349, 345.7699785940349, 345.7699785940349, 343.59999699518085, 343.59999699518085, 341.3099911995232, 341.3099911995232, 341.3099911995232, 339.09999183379114, 339.09999183379114, 336.6400196682662, 336.6400196682662, 334.54998629167676, 334.54998629167676, 334.54998629167676, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.7999881953001, 334.7999881953001, 337.17998303472996, 337.17998303472996, 337.17998303472996, 339.48998316191137, 339.48998316191137, 341.7300176806748, 341.7300176806748, 341.7300176806748, 341.7300176806748, 341.7300176806748, 341.7300176806748, 346.82999830693007, 346.82999830693007, 346.82999830693007, 349.15999276563525, 349.15999276563525, 351.54001670889556, 351.54001670889556, 351.54001670889556, 353.9200115483254, 356.28999467007816, 356.28999467007816, 356.28999467007816, 358.61998912878335, 358.61998912878335, 361.059996066615, 361.059996066615, 361.059996066615, 363.2000007200986, 365.35997060127556, 365.35997060127556, 367.61999945156276, 367.61999945156276, 367.61999945156276, 367.61999945156276, 367.61999945156276, 367.61999945156276, 367.61999945156276, 373.26000165194273, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 372.3299887496978, 372.3299887496978, 372.3299887496978, 369.8499931488186, 369.8499931488186, 369.8499931488186, 367.42998054251075, 367.42998054251075, 365.11998041532934, 365.11998041532934, 362.42001806385815, 362.42001806385815, 360.2099895942956, 360.2099895942956, 358.06000232696533, 358.06000232696533, 358.06000232696533, 358.06000232696533, 358.06000232696533, 358.06000232696533, 358.06000232696533, 351.9500023685396, 351.9500023685396, 351.9500023685396, 349.27998785860837, 349.27998785860837, 346.9100047368556, 346.9100047368556, 346.9100047368556, 344.660016708076, 344.660016708076, 342.4099995754659, 342.4099995754659, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 339.7499967832118, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 335.06000181660056, 335.06000181660056, 335.06000181660056, 337.4899970367551, 337.4899970367551, 337.4899970367551, 337.4899970367551, 337.4899970367551, 337.4899970367551, 344.5400216151029, 344.5400216151029, 344.5400216151029, 346.9600051175803, 346.9600051175803, 349.62999052368104, 349.62999052368104, 352.04002051614225, 352.04002051614225, 352.04002051614225, 354.4999926816672, 356.6300147213042, 356.6300147213042, 356.6300147213042, 358.76999027095735, 358.76999027095735, 358.76999027095735, 361.07999039813876, 361.07999039813876, 363.67998109199107, 363.67998109199107, 366.09999369829893, 366.09999369829893, 366.09999369829893, 366.09999369829893, 366.09999369829893, 366.09999369829893, 366.09999369829893, 371.88001442700624, 371.88001442700624, 371.88001442700624, 374.16000850498676, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 373.1900069396943, 373.1900069396943, 373.1900069396943, 370.8199947141111, 370.8199947141111, 368.3599934447557, 368.3599934447557, 368.3599934447557, 366.26000655815005, 366.26000655815005, 363.85998828336596, 363.85998828336596, 361.51998210698366, 361.51998210698366, 361.51998210698366, 361.51998210698366, 361.51998210698366, 361.51998210698366, 361.51998210698366, 354.86998967826366, 354.86998967826366, 354.86998967826366, 354.86998967826366, 352.04997402615845, 352.04997402615845, 349.5000128168613, 349.5000128168613, 349.5000128168613, 347.1300005912781, 344.73001142032444, 344.73001142032444, 344.73001142032444, 342.489976901561, 342.489976901561, 340.33998963423073, 340.33998963423073, 340.33998963423073, 338.04000122472644, 338.04000122472644, 335.60997690074146, 335.60997690074146, 335.60997690074146, 335.60997690074146, 335.60997690074146, 335.60997690074146, 335.60997690074146, 335.60997690074146, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.98997800052166, 334.98997800052166, 334.98997800052166, 337.42000232450664, 339.83998582698405, 339.83998582698405, 342.2399749979377, 342.2399749979377, 342.2399749979377, 344.6099872235209, 344.6099872235209, 344.6099872235209, 347.14999492280185, 347.14999492280185, 349.60999619215727, 349.60999619215727, 351.85000160709023, 351.85000160709023, 354.1000187397003, 354.1000187397003, 354.1000187397003, 354.1000187397003, 356.4000071492046, 358.9300031308085, 358.9300031308085, 358.9300031308085, 361.39998701401055, 361.39998701401055, 363.8700000010431, 363.8700000010431, 363.8700000010431, 366.32001865655184, 366.32001865655184, 366.32001865655184, 368.8999859150499, 371.26001552678645, 371.26001552678645, 371.26001552678645, 373.3599733095616, 373.3599733095616, 373.3599733095616, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 366.3100069388747, 364.07000152394176, 364.07000152394176, 364.07000152394176, 364.07000152394176, 361.79000744596124, 361.79000744596124, 359.35998312197626, 359.35998312197626, 357.1700071915984, 357.1700071915984, 357.1700071915984, 354.9999964889139, 354.9999964889139, 352.6599903125316, 352.6599903125316, 352.6599903125316, 350.04998790100217, 347.63000439852476, 347.63000439852476, 347.63000439852476, 347.63000439852476, 347.63000439852476, 347.63000439852476, 345.28999822214246, 345.28999822214246, 340.95998853445053, 340.95998853445053, 338.7999895494431, 338.7999895494431, 336.54997241683304, 336.54997241683304, 336.54997241683304, 334.1599949635565, 334.1599949635565, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 337.3500076122582, 337.3500076122582, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 339.56000697799027, 350.32001323997974, 350.32001323997974, 352.7899971231818, 352.7899971231818, 355.1099798642099, 355.1099798642099, 355.1099798642099, 357.2799905668944, 359.4399895519018, 359.4399895519018, 359.4399895519018, 361.6700123529881, 361.6700123529881, 361.6700123529881, 363.7899935711175, 363.7899935711175, 363.7899935711175, 366.21998879127204, 368.8500146381557, 368.8500146381557, 371.000001905486, 371.000001905486, 371.000001905486, 371.000001905486, 371.000001905486, 371.000001905486, 371.000001905486, 371.000001905486, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 370.73000567033887, 370.73000567033887, 370.73000567033887, 368.500011973083, 368.500011973083, 368.500011973083, 366.1199880298227, 366.1199880298227, 363.51001472212374, 363.51001472212374, 363.51001472212374, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 361.3099979702383, 351.7099830787629, 351.7099830787629, 348.68999500758946, 348.68999500758946, 348.68999500758946, 348.68999500758946, 346.2499880697578, 346.2499880697578, 343.31000642850995, 340.7900221645832, 340.7900221645832, 340.7900221645832, 338.5599993634969, 338.5599993634969, 336.39001776464283, 336.39001776464283, 336.39001776464283, 334.1300180181861, 334.1300180181861, 334.1300180181861, 334.1300180181861, 334.1300180181861, 334.1300180181861, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.679993102327, 334.679993102327, 334.679993102327, 337.10000570863485, 339.6600077394396, 339.6600077394396, 339.6600077394396, 341.92000748589635, 341.92000748589635, 341.92000748589635, 344.5699985604733, 344.5699985604733, 346.8599752523005, 346.8599752523005, 346.8599752523005, 349.15999276563525, 349.15999276563525, 349.15999276563525, 349.15999276563525, 349.15999276563525, 349.15999276563525, 349.15999276563525, 349.15999276563525, 351.4800046104938, 351.4800046104938, 359.4800073187798, 359.4800073187798, 359.4800073187798, 361.8599730543792, 361.8599730543792, 364.14997885003686, 364.14997885003686, 366.56000884249806, 366.56000884249806, 368.9599980134517, 368.9599980134517, 368.9599980134517, 371.1300087161362, 371.1300087161362, 371.1300087161362, 371.1300087161362, 371.1300087161362, 373.3299963641912, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 373.2399782165885, 370.9299780894071, 370.9299780894071, 370.9299780894071, 368.6700074467808, 368.6700074467808, 368.6700074467808, 366.1199880298227, 366.1199880298227, 363.75000490806997, 363.75000490806997, 361.6099711507559, 361.6099711507559, 359.35998312197626, 359.35998312197626, 359.35998312197626, 357.0700064301491, 357.0700064301491, 357.0700064301491, 354.3499915394932, 354.3499915394932, 351.85000160709023, 351.85000160709023, 351.85000160709023, 351.85000160709023, 351.85000160709023, 351.85000160709023, 351.85000160709023, 351.85000160709023, 345.5299884080887, 345.5299884080887, 342.9400094319135, 342.9400094319135, 340.5899915378541, 340.5899915378541, 340.5899915378541, 338.120007654652, 335.6700181029737, 335.6700181029737, 333.5799847263843, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 343.7999985180795, 343.7999985180795, 343.7999985180795, 343.7999985180795, 346.4600013103336, 346.4600013103336, 346.4600013103336, 349.1099923849106, 349.1099923849106, 349.1099923849106, 351.2900148052722, 351.2900148052722, 353.9899771567434, 353.9899771567434, 353.9899771567434, 356.5200022421777, 358.94999746233225, 358.94999746233225, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 361.24998587183654, 372.79000389389694, 372.79000389389694, 372.79000389389694, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 370.63000490888953, 370.63000490888953, 370.63000490888953, 368.23999835178256, 368.23999835178256, 368.23999835178256, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 365.9699868876487, 353.35999564267695, 353.35999564267695, 353.35999564267695, 353.35999564267695, 347.58998663164675, 347.58998663164675, 347.58998663164675, 347.58998663164675, 347.58998663164675, 345.179985743016, 345.179985743016, 345.179985743016, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 340.20000020973384, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.9600010551512, 334.9600010551512, 337.42000232450664, 337.42000232450664, 339.6800020709634, 339.6800020709634, 339.6800020709634, 339.6800020709634, 344.7500057518482, 344.7500057518482, 344.7500057518482, 344.7500057518482, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 347.07001759670675, 356.58999695442617, 356.58999695442617, 356.58999695442617, 356.58999695442617, 359.1800050344318, 359.1800050344318, 361.8400078266859, 361.8400078266859, 364.10000757314265, 366.32001865655184, 366.32001865655184, 366.32001865655184, 368.67999006062746, 368.67999006062746, 370.90000114403665, 370.90000114403665, 373.06000012904406, 373.06000012904406, 373.06000012904406, 373.06000012904406, 373.06000012904406, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 372.7200091816485, 372.7200091816485, 372.7200091816485, 370.1800014823675, 370.1800014823675, 370.1800014823675, 367.7600179798901, 365.64000765793025, 365.64000765793025, 365.64000765793025, 363.3299784269184, 363.3299784269184, 363.3299784269184, 360.88001797907054, 360.88001797907054, 358.4400110412389, 358.4400110412389, 356.2999772839248, 356.2999772839248, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 354.0600009728223, 346.4299952611327, 346.4299952611327, 343.81001023575664, 343.81001023575664, 341.55999310314655, 341.55999310314655, 339.14000960066915, 339.14000960066915, 339.14000960066915, 336.7900208104402, 336.7900208104402, 334.1900010127574, 334.1900010127574, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 338.2499853614718, 338.2499853614718, 340.7500043977052, 340.7500043977052, 340.7500043977052, 343.08998147025704, 343.08998147025704, 343.08998147025704, 346.2799941189587, 346.2799941189587, 348.5000052023679, 348.5000052023679, 350.6900102365762, 350.6900102365762, 350.6900102365762, 352.9599925968796, 352.9599925968796, 355.4800059646368, 355.4800059646368, 355.4800059646368, 357.960001565516, 357.960001565516, 360.3200020734221, 360.3200020734221, 360.3200020734221, 360.3200020734221, 360.3200020734221, 360.3200020734221, 360.3200020734221, 366.8100107461214, 366.8100107461214, 366.8100107461214, 369.20999991707504, 369.20999991707504, 371.89997965469956, 371.89997965469956, 371.89997965469956, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 373.1900069396943, 373.1900069396943, 370.90000114403665, 370.90000114403665, 368.7300195451826, 368.7300195451826, 368.7300195451826, 366.5999975055456, 366.5999975055456, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 364.390027243644, 356.39002453535795, 356.39002453535795, 356.39002453535795, 354.01000059209764, 354.01000059209764, 351.4400159474462, 351.4400159474462, 349.029985954985, 349.029985954985, 346.4700130280107, 346.4700130280107, 346.4700130280107, 344.1500011831522, 344.1500011831522, 341.8400010559708, 341.8400010559708, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 339.3900115042925, 337.14002347551286, 337.14002347551286, 337.14002347551286, 337.14002347551286, 335.04999009892344, 335.04999009892344, 337.5899977982044, 337.5899977982044, 337.5899977982044, 337.5899977982044, 339.91000964306295, 339.91000964306295, 342.4400056246668, 342.4400056246668, 342.4400056246668, 345.0599906500429, 345.0599906500429, 345.0599906500429, 347.4400145933032, 347.4400145933032, 350.1099708955735, 350.1099708955735, 352.2999759297818, 352.2999759297818, 354.4200153555721, 354.4200153555721, 354.4200153555721, 356.7000094335526, 356.7000094335526, 356.7000094335526, 356.7000094335526, 356.7000094335526, 360.9800187405199, 360.9800187405199, 363.9899950940162, 363.9899950940162, 363.9899950940162, 366.54999712482095, 366.54999712482095, 366.54999712482095, 368.92000935040414, 368.92000935040414, 371.4199992828071, 371.4199992828071, 373.7799997907132, 373.7799997907132, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 364.72000647336245, 364.72000647336245, 364.72000647336245, 364.72000647336245, 362.46998934075236, 362.46998934075236, 359.9800111260265, 359.9800111260265, 357.4700094759464, 357.4700094759464, 355.33998743630946, 355.33998743630946, 353.13001717440784, 353.13001717440784, 353.13001717440784, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 350.7499932311475, 342.17999200336635, 342.17999200336635, 342.17999200336635, 342.17999200336635, 339.41000583581626, 339.41000583581626, 336.7600147612393, 336.7600147612393, 334.4500146340579, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 335.1199848111719, 335.1199848111719, 337.35999022610486, 337.35999022610486, 339.51998921111226, 339.51998921111226, 339.51998921111226, 339.51998921111226, 339.51998921111226, 339.51998921111226, 339.51998921111226, 346.2300228420645, 346.2300228420645, 348.65998895838857, 348.65998895838857, 348.65998895838857, 351.1700197122991, 351.1700197122991, 353.57000888325274, 353.57000888325274, 355.7099844329059, 355.7099844329059, 357.82999475486577, 357.82999475486577, 357.82999475486577, 360.0799827836454, 360.0799827836454, 362.2900112532079, 362.2900112532079, 364.459992852062, 364.459992852062, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 366.6300035547465, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 372.8500159922987, 372.8500159922987, 370.20997842773795, 370.20997842773795, 370.20997842773795, 368.07998549193144, 368.07998549193144, 365.79000880010426, 365.79000880010426, 363.0499995779246, 363.0499995779246, 360.85001192986965, 358.69001294486225, 358.69001294486225, 358.69001294486225, 356.50000791065395, 356.50000791065395, 356.50000791065395, 356.50000791065395, 356.50000791065395, 356.50000791065395, 350.96998908557, 350.96998908557, 348.65998895838857, 348.65998895838857, 348.65998895838857, 346.01998049765825, 346.01998049765825, 343.78000418655574, 343.78000418655574, 341.52998705394566, 341.52998705394566, 339.17001564987004, 339.17001564987004, 339.17001564987004, 336.76999737508595, 336.76999737508595, 336.76999737508595, 334.30999610573053, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.7399760968983, 334.7399760968983, 337.1899947524071, 337.1899947524071, 339.48998316191137, 339.48998316191137, 341.6599938645959, 341.6599938645959, 341.6599938645959, 343.8900166656822, 343.8900166656822, 346.39000659808517, 346.39000659808517, 346.39000659808517, 349.1200041025877, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 351.3299743644893, 358.4599762689322, 358.4599762689322, 358.4599762689322, 358.4599762689322, 361.100013833493, 361.100013833493, 363.95000643096864, 363.95000643096864, 363.95000643096864, 366.43000203184783, 366.43000203184783, 366.43000203184783, 368.759996490553, 371.2800098583102, 371.2800098583102, 373.8100058399141, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 363.92000038176775, 363.92000038176775, 363.92000038176775, 361.6000176407397, 361.6000176407397, 359.4800073187798, 359.4800073187798, 359.4800073187798, 357.2000132407993, 357.2000132407993, 355.0600085873157, 355.0600085873157, 352.75000846013427, 352.75000846013427, 350.12999433092773, 350.12999433092773, 350.12999433092773, 347.9200240690261, 347.9200240690261, 347.9200240690261, 345.5700061749667, 345.5700061749667, 345.5700061749667, 345.5700061749667, 345.5700061749667, 345.5700061749667, 345.5700061749667, 338.96000240929425, 338.96000240929425, 336.58999018371105, 336.58999018371105, 334.0599942021072, 334.0599942021072, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 337.3099898453802, 337.3099898453802, 337.3099898453802, 337.3099898453802, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 339.94001569226384, 349.0599920041859, 349.0599920041859, 349.0599920041859, 351.3599804136902, 351.3599804136902, 353.8200107868761, 355.9500037226826, 355.9500037226826, 358.19000913761556, 358.19000913761556, 358.19000913761556, 360.390025889501, 360.390025889501, 360.390025889501, 362.7600090112537, 362.7600090112537, 365.34000537358224, 365.34000537358224, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 367.54002212546766, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 370.2600079122931, 370.2600079122931, 370.2600079122931, 368.10999154113233, 368.10999154113233, 368.10999154113233, 365.4899774119258, 365.4899774119258, 362.95998143032193, 362.95998143032193, 362.95998143032193, 360.60999264009297, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 358.17999741993845, 350.6299981381744, 350.6299981381744, 350.6299981381744, 348.1899912003428, 348.1899912003428, 345.82000807859004, 345.82000807859004, 343.4500249568373, 343.4500249568373, 341.28999686799943, 341.28999686799943, 341.28999686799943, 339.07999750226736, 339.07999750226736, 336.66001399978995, 336.66001399978995, 336.66001399978995, 333.89002783223987, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.8400059621781, 334.8400059621781, 334.8400059621781, 337.260018568486, 337.260018568486, 339.4800005480647, 339.4800005480647, 341.74000029452145, 341.74000029452145, 344.29997322149575, 344.29997322149575, 344.29997322149575, 346.6199850663543, 346.6199850663543, 348.79997838288546, 348.79997838288546, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 351.1300019454211, 358.64999517798424, 358.64999517798424, 358.64999517798424, 361.36998096480966, 364.0100185293704, 364.0100185293704, 364.0100185293704, 366.2399831227958, 366.2399831227958, 368.500011973083, 368.500011973083, 370.6800052896142, 370.6800052896142, 370.6800052896142, 372.79000389389694, 372.79000389389694, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 372.97001108527184, 372.97001108527184, 372.97001108527184, 370.4899863805622, 370.4899863805622, 370.4899863805622, 367.95000778511167, 367.95000778511167, 365.4999891296029, 365.4999891296029, 365.4999891296029, 362.8299746196717, 362.8299746196717, 360.4399971663952, 360.4399971663952, 360.4399971663952, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 358.0199845600873, 347.9000006336719, 347.9000006336719, 345.220003509894, 345.220003509894, 342.60997199453413, 342.60997199453413, 342.60997199453413, 340.31999530270696, 340.31999530270696, 340.31999530270696, 337.9200061317533, 335.6300003360957, 335.6300003360957, 335.6300003360957, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 333.21999944746494, 334.6199810039252, 334.6199810039252, 334.6199810039252, 334.6199810039252, 334.6199810039252, 334.6199810039252, 334.6199810039252, 340.30998358502984, 342.7600022405386, 342.7600022405386, 345.0599906500429, 345.0599906500429, 345.0599906500429, 347.29999606497586, 347.29999606497586, 349.73002038896084, 349.73002038896084, 351.89001937396824, 351.89001937396824, 351.89001937396824, 354.20001950114965, 354.20001950114965, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 356.5700026229024, 358.76999027095735, 358.76999027095735, 358.76999027095735, 369.019981008023, 369.019981008023, 369.019981008023, 371.45998794585466, 371.45998794585466, 371.45998794585466, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 374.66001231223345, 370.5799754243344, 370.5799754243344, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 368.2500100694597, 357.29000228457153, 357.29000228457153, 357.29000228457153, 357.29000228457153, 354.89999572746456, 354.89999572746456, 354.89999572746456, 351.96999670006335, 351.96999670006335, 349.74998561665416, 349.74998561665416, 347.2399839665741, 347.2399839665741, 344.920001225546, 344.920001225546))
    expected_first_piece = (
        345.779990311712,
         343.17001700401306,
         340.8599877730012,
         338.4400042705238,
         336.2900170031935,
         334.07998853363097,
         333.21999944746494,
    )
    pieces = split_z_stacks(test_data)
    assert len(pieces[0]) == len(expected_first_piece), pieces[0]
    assert np.allclose(test_data[pieces[0]], expected_first_piece), test_data[pieces[0]]
    assert len(pieces) == 33, len(pieces)


if __name__ == '__main__':
    test_split_z_stacks()
